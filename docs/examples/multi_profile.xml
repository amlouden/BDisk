<?xml version='1.0' encoding='UTF-8'?>
<bdisk>
    <profile name="default" id="1" uuid="8cdd6bcb-c147-4a63-9779-b5433c510dbc">
        <meta>
            <names>
                <name>BDisk</name>
                <uxname>bdisk</uxname>
                <!-- Just like with previous versions of BDisk, you can reference other values...
                     but now with the neat benefits of XPath! Everything you could do in build.ini's and more.
                     See https://www.w3schools.com/xml/xpath_syntax.asp
                     If you need a literal curly brace, double them (e.g. for "{foo}", use "{{foo}}"),
                     UNLESS it's in a {regex%...} placeholder/filter (as part of the expression). -->
                <pname>{xpath%../name/text()}</pname>
            </names>
            <desc>A rescue/restore live environment.</desc>
            <dev>
                <author>A. Dev Eloper</author>
                <email>dev@domain.tld</email>
                <website>https://domain.tld/~dev</website>
            </dev>
            <uri>https://domain.tld/projname</uri>
            <ver>1.0.0</ver>
            <!-- This is the VERY FIRST value parsed, and is required. It controls how many levels of {xpath%...} to recurse. -->
            <!-- If the maximum level is reached, the substitution will evaluate as blank. -->
            <max_recurse>5</max_recurse>
        </meta>
        <accounts>
            <!-- Salted/hashed password is "test" -->
            <rootpass hashed="yes">$6$7KfIdtHTcXwVrZAC$LZGNeMNz7v5o/cYuA48FAxtZynpIwO5B1CPGXnOW5kCTVpXVt4SypRqfM.AoKkFt/O7MZZ8ySXJmxpELKmdlF1</rootpass>
            <user sudo="yes">
                <username>{xpath%//meta/names/uxname/text()}</username>
                <!-- You can also use substitution from different profiles: -->
                <!-- <username>{xpath%//profile[@name='another_profile']/meta/names/uxname"}</username> -->
                <comment>{xpath%//meta/dev/author/text()}</comment>
                <password hashed="no" hash_algo="sha512" salt="auto">testpassword</password>
            </user>
            <user sudo="no">
                <username>testuser</username>
                <name>Test User</name>
                <password hashed="no" hash_algo="sha512" salt="auto">anothertestpassword</password>
            </user>
        </accounts>
        <sources>
            <source arch="x86_64">
                <mirror>http://archlinux.mirror.domain.tld</mirror>
                <webroot>/iso/latest</webroot>
                <tarball flags="regex,latest">{xpath%../mirror/text()}{xpath%../webroot/text()}/{regex%archlinux-bootstrap-[0-9]{4}\.[0-9]{2}\.[0-9]{2}-x86_64\.tar\.gz}</tarball>
                <checksum hash_algo="sha1" flags="none">{xpath%../mirror/text()}{xpath%../webroot/text()}/sha1sums.txt</checksum>
                <sig keys="7F2D434B9741E8AC" keyserver="hkp://pool.sks-keyservers.net" flags="latest">{xpath%../tarball/text()}.sig</sig>
            </source>
            <source arch="i686">
                <mirror>http://archlinux32.mirror.domain.tld</mirror>
                <webroot>/iso/latest</webroot>
                <tarball flag="regex,latest">{xpath%../mirror/text()}/{xpath%../webroot/text()}/{regex%archlinux-bootstrap-[0-9]{4}\.[0-9]{2}\.[0-9]{2}-i686\.tar\.gz}</tarball>
                <checksum hash_algo="sha512" explicit="yes">cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e</checksum>
                <sig keys="248BF41F9BDD61D41D060AE774EDA3C6B06D0506" keyserver="hkp://pool.sks-keyservers.net">{xpath%../tarball/text()}.sig</sig>
            </source>
        </sources>
        <build its_full_of_stars="yes">
            <paths>
                <cache>/var/tmp/{xpath%//meta/names/uxname/text()}</cache>
                <chroot>/var/tmp/chroots/{xpath%//meta/names/uxname/text()}</chroot>
                <overlay>{xpath%../cache/text()}/overlay</overlay>
                <templates>~/{xpath%//meta/names/uxname/text()}/templates</templates>
                <mount>/mnt/{xpath%//meta/names/uxname/text()}</mount>
                <distros>~/{xpath%//meta/names/uxname/text()}/distros</distros>
                <dest>~/{xpath%//meta/names/uxname/text()}/results</dest>
                <iso>{xpath%../dest/text()}/iso</iso>
                <http>{xpath%../dest/text()}/http</http>
                <tftp>{xpath%../dest/text()}/tftp</tftp>
                <pki>{xpath%../dest/text()}/pki</pki>
            </paths>
            <basedistro>archlinux</basedistro>
        </build>
        <iso sign="yes" multiarch="yes"/>
        <ipxe sign="yes" iso="yes">
            <uri>{xpath%//meta/dev/website/text()}/ipxe</uri>
        </ipxe>
        <pki overwrite="no">
            <!-- http://ipxe.org/crypto -->
            <ca>
                <cert>{xpath%../../../build/paths/pki/text()}/ca.crt</cert>
                <!-- If csr is self-enclosed (<csr />), we'll just generate and use a CSR in-memory.
                     Assuming we need to generate a certificate, anyways.
                     If you want to write it out to disk (for debugging, etc.) OR use one already generated,
                     then provide a path.
                     e.g.:
                        <csr>{xpath%build/paths/ssl/text()}/ca.csr</csr> -->
                <csr/>
                <key des="no" passphrase="none">{xpath%../../../build/paths/pki/text()}/ca.key</key>
                <subject>
                    <commonName>domain.tld</commonName>
                    <countryName>XX</countryName>
                    <localityName>Some City</localityName>
                    <stateOrProvinceName>Some State</stateOrProvinceName>
                    <organization>Some Org, Inc.</organization>
                    <organizationalUnitName>Department Name</organizationalUnitName>
                    <emailAddress>{xpath%../../../../meta/dev/email/text()}</emailAddress>
                </subject>
            </ca>
            <client>
                <cert>{xpath%../../../build/paths/pki/text()}/{xpath%../../../meta/names/uxname/text()}.crt</cert>
                <csr/>
                <key des="no" passphrase="none">{xpath%//build/paths/pki/text()}/{xpath%../../../meta/names/uxname/text()}.key</key>
                <subject>
                    <commonName>some client name</commonName>
                    <countryName>XX</countryName>
                    <localityName>Some City</localityName>
                    <stateOrProvinceName>Some State</stateOrProvinceName>
                    <organization>Some Org, Inc.</organization>
                    <organizationalUnitName>Department Name</organizationalUnitName>
                    <emailAddress>{xpath%../../../../meta/dev/email/text()}</emailAddress>
                </subject>
            </client>
        </pki>
        <gpg keyid="none" gnupghome="none" publish="no" sync="yes"/>
        <sync>
            <ipxe enabled="yes" rsync="yes">/srv/http/{xpath%../../meta/names/uxname/text()}</ipxe>
            <tftp enabled="yes" rsync="yes">/tftproot/{xpath%../../meta/names/uxname/text()}</tftp>
            <iso enabled="yes" rsync="yes">/srv/http/isos/{xpath%../../meta/names/uxname/text()}</iso>
            <rsync enabled="yes">
                <user>root</user>
                <host>mirror.domain.tld</host>
                <port>22</port>
                <pubkey>~/.ssh/id_ed25519</pubkey>
            </rsync>
        </sync>
    </profile>
<profile name="alternate" id="2" uuid="2ed07c19-2071-4d66-8569-da40475ba716">
        <meta>
            <names>
                <name>AnotherCD</name>
                <uxname>bdisk_alt</uxname>
                <pname>{xpath%../name/text()}</pname>
            </names>
            <desc>Another rescue/restore live environment.</desc>
            <dev>
                <author>Another Dev Eloper</author>
                <email>{xpath%//profile[@name="default"]/meta/dev/email/text()}</email>
                <website>{xpath%//profile[@name="default"]/meta/dev/website/text()}</website>
            </dev>
            <uri>https://domain.tld/projname</uri>
            <ver>0.0.1</ver>
            <max_recurse>5</max_recurse>
        </meta>
        <accounts>
            <rootpass hashed="no">atotallyinsecurepassword</rootpass>
            <user sudo="no">
                <username>testuser</username>
                <comment>Test User</comment>
                <password hashed="no" hash_algo="sha512" salt="auto">atestpassword</password>
            </user>
            </accounts>
        <sources>
            <source arch="x86_64">
                <mirror>http://archlinux.mirror.domain.tld</mirror>
                <webroot>/iso/latest</webroot>
                <tarball flags="regex,latest">{xpath%../mirror/text()}{xpath%../webroot/text()}/{regex%archlinux-bootstrap-[0-9]{4}\.[0-9]{2}\.[0-9]{2}-x86_64\.tar\.gz}</tarball>
                <checksum hash_algo="sha1" flags="none">{xpath%../mirror/text()}{xpath%../webroot/text()}/sha1sums.txt</checksum>
                <sig keys="7F2D434B9741E8AC" keyserver="hkp://pool.sks-keyservers.net" flags="latest">{xpath%../tarball/text()}.sig</sig>
            </source>
            <source arch="i686">
                <mirror>http://archlinux32.mirror.domain.tld</mirror>
                <webroot>/iso/latest</webroot>
                <tarball flag="regex,latest">{xpath%../mirror/text()}/{xpath%../webroot/text()}/{regex%archlinux-bootstrap-[0-9]{4}\.[0-9]{2}\.[0-9]{2}-i686\.tar\.gz}</tarball>
                <checksum hash_algo="sha512" explicit="yes">cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e</checksum>
                <sig keys="248BF41F9BDD61D41D060AE774EDA3C6B06D0506" keyserver="hkp://pool.sks-keyservers.net">{xpath%../tarball/text()}.sig</sig>
            </source>
        </sources>
        <build its_full_of_stars="yes">
            <paths>
                <cache>/var/tmp/{xpath%//meta/names/uxname/text()}</cache>
                <chroot>/var/tmp/chroots/{xpath%//meta/names/uxname/text()}</chroot>
                <overlay>{xpath%../cache/text()}/overlay</overlay>
                <templates>~/{xpath%//meta/names/uxname/text()}/templates</templates>
                <mount>/mnt/{xpath%//meta/names/uxname/text()}</mount>
                <distros>~/{xpath%//meta/names/uxname/text()}/distros</distros>
                <dest>~/{xpath%//meta/names/uxname/text()}/results</dest>
                <iso>{xpath%../dest/text()}/iso</iso>
                <http>{xpath%../dest/text()}/http</http>
                <tftp>{xpath%../dest/text()}/tftp</tftp>
                <pki>{xpath%../dest/text()}/pki</pki>
            </paths>
            <basedistro>archlinux</basedistro>
        </build>
        <iso sign="yes" multiarch="yes"/>
        <ipxe sign="yes" iso="yes">
            <uri>{xpath%//meta/dev/website/text()}/ipxe</uri>
        </ipxe>
        <pki overwrite="no">
            <ca>
                <cert>{xpath%../../../build/paths/pki/text()}/ca.crt</cert>
                <csr/>
                <key des="no" passphrase="none">{xpath%../../../build/paths/pki/text()}/ca.key</key>
                <subject>
                    <commonName>domain.tld</commonName>
                    <countryName>XX</countryName>
                    <localityName>Some City</localityName>
                    <stateOrProvinceName>Some State</stateOrProvinceName>
                    <organization>Some Org, Inc.</organization>
                    <organizationalUnitName>Department Name</organizationalUnitName>
                    <emailAddress>{xpath%../../../../meta/dev/email/text()}</emailAddress>
                </subject>
            </ca>
            <client>
                <cert>{xpath%../../../build/paths/pki/text()}/{xpath%../../../meta/names/uxname/text()}.crt</cert>
                <csr/>
                <key des="no" passphrase="none">{xpath%//build/paths/pki/text()}/{xpath%../../../meta/names/uxname/text()}.key</key>
                <subject>
                    <commonName>some client name</commonName>
                    <countryName>XX</countryName>
                    <localityName>Some City</localityName>
                    <stateOrProvinceName>Some State</stateOrProvinceName>
                    <organization>Some Org, Inc.</organization>
                    <organizationalUnitName>Department Name</organizationalUnitName>
                    <emailAddress>{xpath%../../../../meta/dev/email/text()}</emailAddress>
                </subject>
            </client>
        </pki>
        <gpg keyid="none" gnupghome="none" publish="no" sync="yes"/>
        <sync>
            <ipxe enabled="yes" rsync="yes">/srv/http/{xpath%../../meta/names/uxname/text()}</ipxe>
            <tftp enabled="yes" rsync="yes">/tftproot/{xpath%../../meta/names/uxname/text()}</tftp>
            <iso enabled="yes" rsync="yes">/srv/http/isos/{xpath%../../meta/names/uxname/text()}</iso>
            <rsync enabled="yes">
                <user>root</user>
                <host>mirror.domain.tld</host>
                <port>22</port>
                <pubkey>~/.ssh/id_ed25519</pubkey>
            </rsync>
        </sync>
    </profile>
</bdisk>
